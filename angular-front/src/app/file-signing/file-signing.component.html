<div class="file-signing-container">
  <div class="page-header">
    <h1>‚úçÔ∏è Digital File Signing</h1>
    <p>Sign and verify digital signatures on your files</p>
  </div>

  <div class="content-card">
    <!-- Files Available for Signing -->
    <div class="files-section">
      <div class="section-header">
        <h2>Your Files for Signing</h2>
        <button 
          (click)="loadFilesForSigning()" 
          [disabled]="isLoading"
          class="refresh-button"
          title="Refresh files list"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6"></path>
            <path d="M1 20v-6h6"></path>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
          </svg>
          Refresh
        </button>
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="loading-spinner">
          <svg class="spinner" viewBox="0 0 50 50">
            <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
          </svg>
          <p>Loading files...</p>
        </div>
      </div>

      <!-- Files List -->
      <div class="files-list" *ngIf="!isLoading">
        <div class="file-item" 
             *ngFor="let file of files" 
             [class.selected]="selectedFile?.id === file.id"
             (click)="selectFile(file)">
          <div class="file-info">
            <div class="file-icon">{{ getFileIcon(file.mimeType) }}</div>
            <div class="file-details">
              <h3 class="file-name">{{ file.originalName }}</h3>
              <div class="file-meta">
                <span class="file-size">{{ formatFileSize(file.fileSize) }}</span>
                <span class="file-date">{{ formatDate(file.createdAt) }}</span>
                <span class="file-owner">üë§ My File</span>
                <span class="signature-status" [class.signed]="file.isSignedByUser">
                  {{ file.isSignedByUser ? '‚úÖ Signed' : '‚è≥ Not Signed' }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="file-actions">
            <button 
              (click)="loadSignatures(file); $event.stopPropagation()" 
              class="action-button view-signatures-button"
              title="View signatures"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              Signatures
            </button>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="files.length === 0">
          <div class="empty-icon">üìÑ</div>
          <h3>No Files Available</h3>
          <p>You don't have any files to sign. Upload some files first!</p>
        </div>
      </div>
    </div>

    <!-- Signing Interface -->
    <div class="signing-section" *ngIf="selectedFile">
      <div class="section-header">
        <h2>Sign File: {{ selectedFile.originalName }}</h2>
      </div>

      <div class="signing-form">
        <div class="file-summary">
          <p><strong>File Hash:</strong> <code>{{ selectedFile.fileHash }}</code></p>
          <p><strong>Owner:</strong> üë§ My File</p>
          <p><strong>Status:</strong> 
            <span [class.signed]="selectedFile.isSignedByUser">
              {{ selectedFile.isSignedByUser ? '‚úÖ Already Signed' : '‚è≥ Not Signed Yet' }}
            </span>
          </p>
        </div>

        <div class="private-key-input" *ngIf="!selectedFile.isSignedByUser">
          <label for="private-key">Your Private Key (PEM format):</label>
          <textarea 
            id="private-key"
            [(ngModel)]="privateKey"
            placeholder="-----BEGIN PRIVATE KEY-----&#10;Your private key here...&#10;-----END PRIVATE KEY-----"
            rows="8"
            class="private-key-textarea"
          ></textarea>
          <p class="input-hint">‚ö†Ô∏è Your private key is used only for signing and is not stored on the server.</p>
        </div>

        <div class="signing-actions">
          <button 
            (click)="signFile()" 
            [disabled]="!privateKey.trim() || isSigning || selectedFile.isSignedByUser"
            class="sign-button"
            *ngIf="!selectedFile.isSignedByUser"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"></path>
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            {{ isSigning ? 'Signing...' : 'Sign File' }}
          </button>
          
          <div class="already-signed" *ngIf="selectedFile.isSignedByUser">
            <p>‚úÖ This file has already been signed by you.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Signatures Modal -->
    <div class="signatures-modal" *ngIf="showSignatures">
      <div class="modal-content">
        <div class="modal-header">
          <h3>File Signatures</h3>
          <button (click)="closeSignatures()" class="close-button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        
        <div class="signatures-list">
          <div class="signature-item" *ngFor="let signature of signatures">
            <div class="signature-info">
              <div class="signer-info">
                <strong>{{ signature.signerName }}</strong>
                <span class="signer-email">{{ signature.signerEmail }}</span>
              </div>
              <div class="signature-details">
                <span class="signature-date">{{ formatDate(signature.signedAt) }}</span>
                <span class="signature-hash">{{ signature.signatureHash.substring(0, 16) }}...</span>
              </div>
            </div>
            
            <button 
              (click)="verifySignature(signature)" 
              class="verify-signature-button"
              title="Verify this signature"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"></path>
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
              Verify
            </button>
          </div>
          
          <div class="empty-signatures" *ngIf="signatures.length === 0">
            <p>No signatures found for this file.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      ‚ùå {{ errorMessage }}
    </div>
  </div>
</div> 